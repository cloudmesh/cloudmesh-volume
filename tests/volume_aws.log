aws
============================= test session starts ==============================
platform darwin -- Python 3.8.1, pytest-5.4.1, py-1.8.1, pluggy-0.13.1 -- /Users/xingu/ENV3/bin/python3.8
cachedir: .pytest_cache
rootdir: /Users/xingu/cm/cloudmesh-volume, inifile: pytest.ini
plugins: cov-2.8.1
collecting ... [34m
# ----------------------------------------------------------------------
# variables.dict()
# ----------------------------------------------------------------------
# 26:<module> ./tests/test_01_setup.py
# ----------------------------------------------------------------------
# {'cloud': 'aws',
#  'debug': 'True',
#  'key': 'xingu',
#  'timer': 'True',
#  'trace': 'True',
#  'verbose': '10',
#  'vm': 'test-xingu-vm-184',
#  'vm_name': 'test-xingu-vm-185',
#  'volume': 'test-xingu-volume-185'}
# ----------------------------------------------------------------------
[0m
Test run for aws
collected 2 items

tests/test_01_setup.py::Test_provider_volume::test_cms_vm 
[35m
# ######################################################################
# test_cms_vm /tests/test_01_setup.py 61
# ######################################################################
[0m
vm boot --name=test-xingu-vm-186

# ----------------------------------------------------------------------
# Create Server
# ----------------------------------------------------------------------

    Name:     test-xingu-vm-186
    User:     root
    IP:       None
    Image:    ami-0c929bde1796e1484
    Size:     t2.medium
    Public:   None
    Key:      xingu
    Location: None
    Timeout:  360
    Secgroup: default
    Group:    default


Instance created...

Waiting for the Public IP address assignment ...
    Public IP:   18.217.251.239
    Private IP:  172.31.8.118
ERROR: aws reported the following error
ERROR: -------------------------------------------------------------------------------
set_server_metadata() got an unexpected keyword argument 'cm'
ERROR: -------------------------------------------------------------------------------

# ----------------------------------------------------------------------
# created
# ----------------------------------------------------------------------
# 220:create /Users/xingu/cm/cloudmesh-cloud/cloudmesh/compute/vm/Provider.py
# ----------------------------------------------------------------------
# [{'AmiLaunchIndex': 0,
#   'Architecture': 'x86_64',
#   'BlockDeviceMappings': [],
#   'CapacityReservationSpecification': {'CapacityReservationPreference': 'open'},
#   'ClientToken': '',
#   'CpuOptions': {'CoreCount': 2, 'ThreadsPerCore': 1},
#   'EbsOptimized': False,
#   'EnaSupport': True,
#   'HibernationOptions': {'Configured': False},
#   'Hypervisor': 'xen',
#   'ImageId': 'ami-0c929bde1796e1484',
#   'InstanceId': 'i-098cc19d3b903e735',
#   'InstanceType': 't2.medium',
#   'KeyName': 'xingu',
#   'LaunchTime': datetime.datetime(2020, 4, 27, 14, 29, 51, tzinfo=tzutc()),
#   'MetadataOptions': {'HttpEndpoint': 'enabled',
#                       'HttpPutResponseHopLimit': 1,
#                       'HttpTokens': 'optional',
#                       'State': 'pending'},
#   'Monitoring': {'State': 'disabled'},
#   'NetworkInterfaces': [{'Attachment': {'AttachTime': datetime.datetime(2020, 4, 27, 14, 29, 51, tzinfo=tzutc()),
#                                         'AttachmentId': 'eni-attach-0139d40579d99e82e',
#                                         'DeleteOnTermination': True,
#                                         'DeviceIndex': 0,
#                                         'Status': 'attaching'},
#                          'Description': '',
#                          'Groups': [{'GroupId': 'sg-23f08e45',
#                                      'GroupName': 'default'}],
#                          'InterfaceType': 'interface',
#                          'Ipv6Addresses': [],
#                          'MacAddress': '02:f2:9c:cc:84:2e',
#                          'NetworkInterfaceId': 'eni-048dfc092e6435461',
#                          'OwnerId': '998726019676',
#                          'PrivateDnsName': 'ip-172-31-8-118.us-east-2.compute.internal',
#                          'PrivateIpAddress': '172.31.8.118',
#                          'PrivateIpAddresses': [{'Primary': True,
#                                                  'PrivateDnsName': 'ip-172-31-8-118.us-east-2.compute.internal',
#                                                  'PrivateIpAddress': '172.31.8.118'}],
#                          'SourceDestCheck': True,
#                          'Status': 'in-use',
#                          'SubnetId': 'subnet-bd46b6d6',
#                          'VpcId': 'vpc-e334fc88'}],
#   'Placement': {'AvailabilityZone': 'us-east-2a',
#                 'GroupName': '',
#                 'Tenancy': 'default'},
#   'PrivateDnsName': 'ip-172-31-8-118.us-east-2.compute.internal',
#   'PrivateIpAddress': '172.31.8.118',
#   'ProductCodes': [],
#   'PublicDnsName': '',
#   'RootDeviceName': '/dev/sda1',
#   'RootDeviceType': 'ebs',
#   'SecurityGroups': [{'GroupId': 'sg-23f08e45', 'GroupName': 'default'}],
#   'SourceDestCheck': True,
#   'State': {'Code': 0, 'Name': 'pending'},
#   'StateTransitionReason': '',
#   'SubnetId': 'subnet-bd46b6d6',
#   'Tags': [{'Key': 'cm.flavor', 'Value': 't2.medium'},
#            {'Key': 'cm.kind', 'Value': 'vm'},
#            {'Key': 'cm.user', 'Value': 'xingu'},
#            {'Key': 'cm.image', 'Value': 'ami-0c929bde1796e1484'},
#            {'Key': 'cm.name', 'Value': 'test-xingu-vm-186'},
#            {'Key': 'Name', 'Value': 'test-xingu-vm-186'},
#            {'Key': 'cm.status', 'Value': 'BOOTING'}],
#   'VirtualizationType': 'hvm',
#   'VpcId': 'vpc-e334fc88',
#   '_id': ObjectId('5ea6ec5d46afb4bcb039dcfd'),
#   'cm': {'cloud': 'aws',
#          'collection': 'aws-vm',
#          'created': '2020-04-27 14:29:49.967216',
#          'creation': '25.00',
#          'group': 'default',
#          'kind': 'vm',
#          'label': 'test-xingu-vm-186',
#          'modified': '2020-04-27 14:30:15.454181',
#          'name': 'test-xingu-vm-186',
#          'status': 'available'},
#   'created': ('04/27/2020, 14:29:51',),
#   'image': ('ami-0c929bde1796e1484',),
#   'instance_id': ('i-098cc19d3b903e735',),
#   'key_name': ('xingu',),
#   'kind': 'aws',
#   'metadata': '{\'cm\': "{\'kind\': \'vm\', \'name\': \'test-xingu-vm-186\', '
#               "'label': 'test-xingu-vm-186', 'group': 'default', 'cloud': "
#               "'aws', 'status': 'available', 'collection': 'aws-vm', "
#               "'created': '2020-04-27 14:29:49.967216', 'modified': "
#               '\'2020-04-27 14:29:49.967216\', \'creation\': \'25.00\'}", '
#               "'image': 'ami-0c929bde1796e1484', 'size': 't2.medium'}",
#   'name': ('t2.medium',),
#   'private_ips': '172.31.8.118',
#   'public_ips': '18.217.251.239',
#   'status': ('pending',),
#   'updated': ('04/27/2020, 14:29:51',)}]
# ----------------------------------------------------------------------

Timer: 27.0000s Load: 0.0000s (line_strip)

PASSED
tests/test_01_setup.py::Test_provider_volume::test_benchmark 

+---------------------------+----------+--------+---------------------+-------+------------------------+--------+--------+-----------+
| Name                      | Status   |   Time | Start               | tag   | Node                   | User   | OS     | Version   |
|---------------------------+----------+--------+---------------------+-------+------------------------+--------+--------+-----------|
| test_01_setup/test_cms_vm | ok       | 28.509 | 2020-04-27 14:29:48 | aws   | Xins-MacBook-Pro.local | xingu  | Darwin | 10.15.3   |
+---------------------------+----------+--------+---------------------+-------+------------------------+--------+--------+-----------+

# csv,timer,status,time,start,tag,uname.node,user,uname.system,platform.version
# csv,test_01_setup/test_cms_vm,ok,28.509,2020-04-27 14:29:48,aws,Xins-MacBook-Pro.local,xingu,Darwin,10.15.3

PASSED

============================== 2 passed in 29.69s ==============================
============================= test session starts ==============================
platform darwin -- Python 3.8.1, pytest-5.4.1, py-1.8.1, pluggy-0.13.1 -- /Users/xingu/ENV3/bin/python3.8
cachedir: .pytest_cache
rootdir: /Users/xingu/cm/cloudmesh-volume, inifile: pytest.ini
plugins: cov-2.8.1
collecting ... [34m
# ----------------------------------------------------------------------
# variables.dict()
# ----------------------------------------------------------------------
# 24:<module> ./tests/test_02_volume_provider.py
# ----------------------------------------------------------------------
# {'cloud': 'aws',
#  'debug': 'True',
#  'key': 'xingu',
#  'timer': 'True',
#  'trace': 'True',
#  'verbose': '10',
#  'vm': 'test-xingu-vm-186',
#  'vm_name': 'test-xingu-vm-186',
#  'volume': 'test-xingu-volume-185'}
# ----------------------------------------------------------------------
[0m
Test run for aws
collected 6 items

tests/test_02_volume_provider.py::Test_provider_volume::test_provider_volume_create volume list --cloud=aws

# ----------------------------------------------------------------------
# arguments
# ----------------------------------------------------------------------
# 118:do_volume ./cloudmesh/volume/command/volume.py
# ----------------------------------------------------------------------
# {'--cloud': 'aws',
#  '--description': None,
#  '--dryrun': False,
#  '--key': None,
#  '--output': 'table',
#  '--path': None,
#  '--refresh': False,
#  '--region': None,
#  '--size': None,
#  '--value': None,
#  '--vm': None,
#  '--volume_type': None,
#  'NAME': None,
#  'NAMES': None,
#  'add_tag': False,
#  'attach': False,
#  'create': False,
#  'delete': False,
#  'detach': False,
#  'list': True,
#  'migrate': False,
#  'purge': False,
#  'status': False,
#  'sync': False}
# ----------------------------------------------------------------------

+-----------------------+-------+--------+------------+----------------------------+----------+---------+------+-------------+-----------------------+
| Name                  | Cloud | Kind   | Region     | Create Time                | Size(GB) | Status  | Tags | Volume Type | Attached To Vm        |
+-----------------------+-------+--------+------------+----------------------------+----------+---------+------+-------------+-----------------------+
| test-xingu-volume-184 | aws   | volume | us-east-2a | 2020-04-27 13:42:58.067000 | 2        | deleted | []   | gp2         |                       |
|                       | aws   | volume | us-east-2a | 2020-04-27 13:42:37.051000 | 8        | in-use  |      | gp2         | ['test-xingu-vm-184'] |
+-----------------------+-------+--------+------------+----------------------------+----------+---------+------+-------------+-----------------------+
None
Timer: 0.0000s Load: 0.0000s (line_strip)

[35m
# ######################################################################
# test_provider_volume_create /tests/test_02_volume_provider.py 47
# ######################################################################
[0m
PASSED
tests/test_02_volume_provider.py::Test_provider_volume::test_provider_volume_list 
[35m
# ######################################################################
# test_provider_volume_list /tests/test_02_volume_provider.py 76
# ######################################################################
[0m
PASSED
tests/test_02_volume_provider.py::Test_provider_volume::test_provider_volume_attach 
[35m
# ######################################################################
# test_provider_volume_attach /tests/test_02_volume_provider.py 86
# ######################################################################
[0m
PASSED
tests/test_02_volume_provider.py::Test_provider_volume::test_provider_volume_detach 
[35m
# ######################################################################
# test_provider_volume_detach /tests/test_02_volume_provider.py 115
# ######################################################################
[0m
PASSED
tests/test_02_volume_provider.py::Test_provider_volume::test_provider_volume_delete 
[35m
# ######################################################################
# test_provider_volume_delete /tests/test_02_volume_provider.py 139
# ######################################################################
[0m
PASSED
tests/test_02_volume_provider.py::Test_provider_volume::test_benchmark 

+-----------------------------------------------------+----------+--------+---------------------+-------+------------------------+--------+--------+-----------+
| Name                                                | Status   |   Time | Start               | tag   | Node                   | User   | OS     | Version   |
|-----------------------------------------------------+----------+--------+---------------------+-------+------------------------+--------+--------+-----------|
| test_02_volume_provider/test_provider_volume_create | ok       |  0.445 | 2020-04-27 14:30:20 | aws   | Xins-MacBook-Pro.local | xingu  | Darwin | 10.15.3   |
| test_02_volume_provider/test_provider_volume_list   | ok       |  0.512 | 2020-04-27 14:30:36 | aws   | Xins-MacBook-Pro.local | xingu  | Darwin | 10.15.3   |
| test_02_volume_provider/test_provider_volume_attach | ok       |  3.443 | 2020-04-27 14:30:37 | aws   | Xins-MacBook-Pro.local | xingu  | Darwin | 10.15.3   |
| test_02_volume_provider/test_provider_volume_detach | ok       | 11.102 | 2020-04-27 14:30:45 | aws   | Xins-MacBook-Pro.local | xingu  | Darwin | 10.15.3   |
| test_02_volume_provider/test_provider_volume_delete | ok       |  5.384 | 2020-04-27 14:31:01 | aws   | Xins-MacBook-Pro.local | xingu  | Darwin | 10.15.3   |
+-----------------------------------------------------+----------+--------+---------------------+-------+------------------------+--------+--------+-----------+

# csv,timer,status,time,start,tag,uname.node,user,uname.system,platform.version
# csv,test_02_volume_provider/test_provider_volume_create,ok,0.445,2020-04-27 14:30:20,aws,Xins-MacBook-Pro.local,xingu,Darwin,10.15.3
# csv,test_02_volume_provider/test_provider_volume_list,ok,0.512,2020-04-27 14:30:36,aws,Xins-MacBook-Pro.local,xingu,Darwin,10.15.3
# csv,test_02_volume_provider/test_provider_volume_attach,ok,3.443,2020-04-27 14:30:37,aws,Xins-MacBook-Pro.local,xingu,Darwin,10.15.3
# csv,test_02_volume_provider/test_provider_volume_detach,ok,11.102,2020-04-27 14:30:45,aws,Xins-MacBook-Pro.local,xingu,Darwin,10.15.3
# csv,test_02_volume_provider/test_provider_volume_delete,ok,5.384,2020-04-27 14:31:01,aws,Xins-MacBook-Pro.local,xingu,Darwin,10.15.3

PASSED

============================== 6 passed in 49.58s ==============================
============================= test session starts ==============================
platform darwin -- Python 3.8.1, pytest-5.4.1, py-1.8.1, pluggy-0.13.1 -- /Users/xingu/ENV3/bin/python3.8
cachedir: .pytest_cache
rootdir: /Users/xingu/cm/cloudmesh-volume, inifile: pytest.ini
plugins: cov-2.8.1
collecting ... [34m
# ----------------------------------------------------------------------
# variables.dict()
# ----------------------------------------------------------------------
# 21:<module> ./tests/test_03_teardown.py
# ----------------------------------------------------------------------
# {'cloud': 'aws',
#  'debug': 'True',
#  'key': 'xingu',
#  'timer': 'True',
#  'trace': 'True',
#  'verbose': '10',
#  'vm': 'test-xingu-vm-186',
#  'vm_name': 'test-xingu-vm-186',
#  'volume': ' '}
# ----------------------------------------------------------------------
[0m
collected 2 items

tests/test_03_teardown.py::Test_provider_volume::test_cms_terminate 
[35m
# ######################################################################
# test_cms_terminate /tests/test_03_teardown.py 32
# ######################################################################
[0m
result vm terminate test-xingu-vm-186
ec2.instancesCollection(ec2.ServiceResource(), ec2.Instance)
ec2.instancesCollection(ec2.ServiceResource(), ec2.Instance)
Terminating Instance..Please wait...
Instance having Tag:test-xingu-vm-186 and Instance-Id:i-098cc19d3b903e735 terminated
+--------+---------+---------------+----------+---------+--------------+---------------+-----------------+--------------+--------+
| Name   | Cloud   | Instance ID   | Status   | Image   | Public IPs   | Private IPs   | Creation Time   | Started at   | Kind   |
|--------+---------+---------------+----------+---------+--------------+---------------+-----------------+--------------+--------|
+--------+---------+---------------+----------+---------+--------------+---------------+-----------------+--------------+--------+
Timer: 32.0000s Load: 0.0000s (line_strip)

PASSED
tests/test_03_teardown.py::Test_provider_volume::test_benchmark 

+-------------------------------------+----------+--------+---------------------+-------+------------------------+--------+--------+-----------+
| Name                                | Status   |   Time | Start               | tag   | Node                   | User   | OS     | Version   |
|-------------------------------------+----------+--------+---------------------+-------+------------------------+--------+--------+-----------|
| test_03_teardown/test_cms_terminate | ok       | 32.708 | 2020-04-27 14:31:08 | aws   | Xins-MacBook-Pro.local | xingu  | Darwin | 10.15.3   |
+-------------------------------------+----------+--------+---------------------+-------+------------------------+--------+--------+-----------+

# csv,timer,status,time,start,tag,uname.node,user,uname.system,platform.version
# csv,test_03_teardown/test_cms_terminate,ok,32.708,2020-04-27 14:31:08,aws,Xins-MacBook-Pro.local,xingu,Darwin,10.15.3

PASSED

============================== 2 passed in 33.37s ==============================
